<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APONGSKY STUDIO x STILL ALIVE v100</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Syne:wght@800&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: white; font-family: 'Space Grotesk', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .tmpl-btn { transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.1); color: rgba(255,255,255,0.5); }
        .tmpl-btn.active { background: white; color: black; border-color: white; transform: scale(1.05); }
        .flash-active { animation: flashAnim 0.2s ease-out; }
        @keyframes flashAnim { from { opacity: 0; } to { opacity: 1; } }
        #video-feed { transform: scaleX(-1); border-radius: 20px; }
    </style>
</head>
<body class="p-4 flex flex-col items-center">

    <div class="w-full max-w-[500px] flex justify-between items-center p-3 bg-yellow-400 text-black font-black text-[10px] rounded-2xl mb-6 shadow-xl">
        <span class="tracking-widest">APONGSKY x STILL ALIVE v100</span>
        <button onclick="window.open('https://saweria.co/apongsky', '_blank')" class="bg-black text-white px-4 py-1.5 rounded-full animate-bounce">
            SUPPORT VIA SAWERIA ☕
        </button>
    </div>

    <div class="relative w-full max-w-[500px] aspect-[3/4] glass rounded-[30px] overflow-hidden mb-6">
        <video id="video-feed" class="w-full h-full object-cover" autoplay playsinline></video>
        <div id="screen-flash" class="absolute inset-0 bg-white opacity-0 pointer-events-none"></div>
        <div id="countdown" class="absolute inset-0 flex items-center justify-center text-9xl font-black text-white hidden"></div>
    </div>

    <div class="w-full max-w-[500px] mb-6">
        <p class="text-[9px] opacity-40 mb-3 text-center font-bold tracking-[0.3em]">SELECT GRID DENSITY</p>
        <div class="grid grid-cols-4 gap-2">
            <button onclick="setGrid(1)" data-grid="1" class="grid-btn p-2 rounded-xl glass text-[10px] font-bold">1 FOTO</button>
            <button onclick="setGrid(4)" data-grid="4" class="grid-btn p-2 rounded-xl glass text-[10px] font-bold bg-white text-black">4 FOTO</button>
            <button onclick="setGrid(6)" data-grid="6" class="grid-btn p-2 rounded-xl glass text-[10px] font-bold">6 FOTO</button>
            <button onclick="setGrid(8)" data-grid="8" class="grid-btn p-2 rounded-xl glass text-[10px] font-bold">8 FOTO</button>
        </div>
    </div>

    <div class="w-full max-w-[500px] glass p-4 rounded-[25px] mb-8">
        <p class="text-[9px] opacity-40 mb-4 text-center font-bold tracking-[0.3em]">20+ ARCHIVE TEMPLATES</p>
        <div class="grid grid-cols-4 gap-2">
            <button onclick="setTmpl('classic', this)" class="tmpl-btn p-2 rounded-lg text-[8px] active">CLEAN</button>
            <button onclick="setTmpl('parking', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">PARK</button>
            <button onclick="setTmpl('vhs', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">VHS</button>
            <button onclick="setTmpl('insta', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">INSTA</button>
            <button onclick="setTmpl('magazine', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">VOGUE</button>
            <button onclick="setTmpl('film', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">KODAK</button>
            <button onclick="setTmpl('cyber', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">CYBER</button>
            <button onclick="setTmpl('cute', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">CUTE</button>
            <button onclick="setTmpl('journal', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">NEWS</button>
            <button onclick="setTmpl('natgeo', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">WILD</button>
            <button onclick="setTmpl('spotify', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">SONG</button>
            <button onclick="setTmpl('manga', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">MANGA</button>
            <button onclick="setTmpl('horror', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">EVIL</button>
            <button onclick="setTmpl('ticket', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">TIKET</button>
            <button onclick="setTmpl('cd', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">ALBUM</button>
            <button onclick="setTmpl('poster', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">WANTED</button>
            <button onclick="setTmpl('neon', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">GLOW</button>
            <button onclick="setTmpl('minimal', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">ART</button>
            <button onclick="setTmpl('arcade', this)" class="tmpl-btn p-2 rounded-lg text-[8px]">8-BIT</button>
            <button onclick="setTmpl('apong', this)" class="tmpl-btn p-2 rounded-lg text-[8px] bg-cyan-900/50">APONG!</button>
        </div>
    </div>

    <button id="snap-btn" onclick="startSession()" class="w-full max-w-[500px] py-6 bg-white text-black font-black rounded-[25px] text-xl tracking-tighter hover:bg-cyan-400 transition-all active:scale-95 shadow-[0_0_30px_rgba(255,255,255,0.2)]">
        CAPTURE THE MOMENT
    </button>

    <div class="mt-12 text-center opacity-20 text-[8px] tracking-[0.5em] font-bold">
        DESIGNED BY APONGSKY STUDIO © 2026<br>ALL RIGHTS RESERVED
    </div>

    <div id="modal" class="fixed inset-0 bg-black/95 hidden flex-col items-center justify-center p-4 z-50">
        <canvas id="display-canvas" class="max-w-full max-h-[70vh] rounded-lg shadow-2xl mb-6"></canvas>
        <div class="flex gap-4">
            <button onclick="location.reload()" class="bg-white text-black px-8 py-3 rounded-full font-bold text-sm">RETAKE</button>
            <button onclick="downloadImage()" class="bg-cyan-500 text-white px-8 py-3 rounded-full font-bold text-sm">DOWNLOAD PDF/IMG</button>
        </div>
    </div>

    <script>
        let currentTemplate = 'classic';
        let totalPhotos = 4;
        let poses = [];
        const video = document.getElementById('video-feed');
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        // Camera Setup
        navigator.mediaDevices.getUserMedia({ video: { aspectRatio: 3/4 }, audio: false })
            .then(stream => video.srcObject = stream);

        function setGrid(n) {
            totalPhotos = n;
            document.querySelectorAll('.grid-btn').forEach(b => {
                b.classList.remove('bg-white', 'text-black');
                if(parseInt(b.dataset.grid) === n) b.classList.add('bg-white', 'text-black');
            });
        }

        function setTmpl(t, btn) {
            currentTemplate = t;
            document.querySelectorAll('.tmpl-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        async function startSession() {
            poses = [];
            const btn = document.getElementById('snap-btn');
            btn.disabled = true; btn.innerText = "SMILE!";

            for(let i=0; i<totalPhotos; i++) {
                let count = 3;
                const cd = document.getElementById('countdown');
                cd.classList.remove('hidden');
                while(count > 0) {
                    cd.innerText = count;
                    await new Promise(r => setTimeout(r, 800));
                    count--;
                }
                cd.classList.add('hidden');
                
                // Snap logic
                canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                ctx.translate(canvas.width, 0); ctx.scale(-1, 1);
                ctx.drawImage(video, 0, 0);
                poses.push(canvas.toDataURL('image/jpeg'));
                
                document.getElementById('screen-flash').classList.add('flash-active');
                setTimeout(() => document.getElementById('screen-flash').classList.remove('flash-active'), 100);
                await new Promise(r => setTimeout(r, 1000));
            }
            renderFinal();
        }

        async function renderFinal() {
            const out = document.getElementById('display-canvas');
            const octx = out.getContext('2d');
            out.width = 1000; out.height = 1600;

            // BG
            octx.fillStyle = (currentTemplate === 'vhs' || currentTemplate === 'horror') ? '#050505' : '#fff';
            octx.fillRect(0,0,1000,1600);

            // GRID RENDER
            const top = 180;
            for(let i=0; i<totalPhotos; i++) {
                const img = new Image(); img.src = poses[i];
                await new Promise(r => img.onload = r);
                octx.shadowBlur = 15; octx.shadowColor = "rgba(0,0,0,0.2)";
                
                if(totalPhotos === 1) octx.drawImage(img, 100, 300, 800, 1000);
                else if(totalPhotos === 4) octx.drawImage(img, 80, top + (i*345), 840, 330);
                else {
                    let col = i%2; let row = Math.floor(i/2);
                    let h = (totalPhotos === 6) ? 440 : 330;
                    octx.drawImage(img, 60 + (col*450), top + (row*(h+15)), 430, h);
                }
            }

            // OVERLAY HAK CIPTA & TEMPLATE (Detail v100)
            octx.shadowBlur = 0; octx.textAlign = "center"; octx.fillStyle = "#000";
            if(currentTemplate === 'parking') {
                octx.font = "bold 40px monospace"; octx.fillText("KARCIS PARKIR APONGSKY", 500, 100);
                octx.font = "15px monospace"; octx.fillText("SEGALA KENANGAN BUKAN TANGGUNG JAWAB PENGELOLA", 500, 1550);
            }
            
            // WATERMARK PERMANEN
            octx.globalAlpha = 0.5;
            octx.font = "900 15px sans-serif";
            octx.fillText("© 2026 APONGSKY STUDIO | STILL ALIVE ARCHIVE v100", 500, 1585);
            
            document.getElementById('modal').style.display = 'flex';
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = `apongsky-archive-${Date.now()}.jpg`;
            link.href = document.getElementById('display-canvas').toDataURL('image/jpeg', 0.9);
            link.click();
        }
    </script>
</body>
</html>
