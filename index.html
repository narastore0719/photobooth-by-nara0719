<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NaraBooth Premium V21</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #ff7675; --bg: #0f1115; --yellow: #feca57; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; display: flex; justify-content: center; min-height: 100vh; overflow-x: hidden; }
        .container { width: 100%; max-width: 450px; background: #1a1c23; padding: 25px; border-radius: 40px; border: 2px solid #333; text-align: center; position: relative; }
        
        .header h1 { margin: 0; font-size: 28px; background: linear-gradient(45deg, #ff7675, #fab1a0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        .header p { font-size: 10px; opacity: 0.5; letter-spacing: 2px; margin-bottom: 20px; }

        .screen-container { position: relative; background: #000; border-radius: 30px; overflow: hidden; aspect-ratio: 1/1; border: 4px solid #2d3436; margin-bottom: 20px; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); filter: brightness(1.2) contrast(1.1); }
        
        .timer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 100px; font-weight: 800; z-index: 100; color: white; }
        .flash { position: absolute; top:0; left:0; width:100%; height:100%; background:white; opacity:0; pointer-events:none; z-index:101; }
        .flash-active { opacity:1; transition: 0.1s; }
        
        .sticker-box { display: flex; gap: 12px; overflow-x: auto; padding: 10px; background: #111; border-radius: 20px; margin-bottom: 15px; border: 1px solid #333; }
        .sticker-item { font-size: 32px; cursor: pointer; }

        #startBtn { width: 100%; background: linear-gradient(135deg, #ff7675, #d63031); color: white; border: none; padding: 20px; border-radius: 20px; font-size: 18px; font-weight: 800; cursor: pointer; box-shadow: 0 10px 25px rgba(214, 48, 49, 0.4); }
        
        canvas { max-width: 100%; border-radius: 25px; margin-top: 20px; display: none; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .btn-save { background: #00b894; color: white; border: none; padding: 18px; border-radius: 15px; width: 100%; margin-top: 15px; display: none; font-weight: 800; }

        /* Popup Saweria / QRIS */
        .qris-popup { display: none; margin-top: 25px; padding: 20px; background: rgba(254, 202, 87, 0.1); border: 2px dashed var(--yellow); border-radius: 30px; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .saweria-link { background: var(--yellow); color: #2d3436; text-decoration: none; font-weight: 800; padding: 15px 30px; border-radius: 15px; display: inline-block; margin-top: 10px; font-size: 14px; box-shadow: 0 5px 15px rgba(254, 202, 87, 0.3); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>NARA BOOTH</h1>
        <p>V21 BRIGHT & PROFIT MODE</p>
    </div>

    <div class="screen-container">
        <div id="flash" class="flash"></div>
        <div id="timer" class="timer"></div>
        <video id="webcam" autoplay playsinline></video>
    </div>

    <div class="sticker-box">
        <span class="sticker-item" onclick="addSticker('üê±')">üê±</span>
        <span class="sticker-item" onclick="addSticker('üéÄ')">üéÄ</span>
        <span class="sticker-item" onclick="addSticker('‚ú®')">‚ú®</span>
        <span class="sticker-item" onclick="addSticker('‚ù§Ô∏è')">‚ù§Ô∏è</span>
        <span class="sticker-item" onclick="addSticker('üëë')">üëë</span>
    </div>

    <button id="startBtn" onclick="startSession()">üì∏ MULAI FOTO</button>
    <canvas id="finalCanvas"></canvas>
    <button id="downloadBtn" class="btn-save" onclick="downloadImage()">üíæ SIMPAN FOTO</button>

    <div id="qrisPopup" class="qris-popup">
        <h3 style="margin:0; color: var(--yellow);">Suka hasilnya? ‚ú®</h3>
        <p style="font-size: 11px; opacity: 0.8;">Traktir NaraStore kopi via Gopay/QRIS yuk!</p>
        <p style="font-size: 14px; font-weight: 800; margin: 5px 0;">083825256323</p>
        <a href="https://saweria.co/narastore0719" target="_blank" class="saweria-link">üí∏ BAYAR PAKAI QRIS / GOPAY</a>
    </div>
</div>

<audio id="beep" src="https://www.soundjay.com/button/beep-07.mp3"></audio>
<audio id="shutter" src="https://www.soundjay.com/free-music/shutter-click-01.mp3"></audio>

<script>
const video = document.getElementById('webcam');
const timerEl = document.getElementById('timer');
const flashEl = document.getElementById('flash');
const canvas = document.getElementById('finalCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const downloadBtn = document.getElementById('downloadBtn');
const qrisPopup = document.getElementById('qrisPopup');

const beep = document.getElementById('beep');
const shutter = document.getElementById('shutter');

let capturedImages = [], stickers = [];

navigator.mediaDevices.getUserMedia({ 
    video: { facingMode: "user", width: 720, height: 720 } 
}).then(s => video.srcObject = s);

async function startSession() {
    capturedImages = []; stickers = [];
    canvas.style.display = 'none'; downloadBtn.style.display = 'none';
    qrisPopup.style.display = 'none';
    startBtn.disabled = true;

    for(let i=0; i<4; i++) {
        for(let c=3; c>=0; c--) {
            timerEl.innerText = c > 0 ? c : "";
            if(c > 0) beep.play();
            await new Promise(r => setTimeout(r, 1000));
        }
        flashEl.classList.add('flash-active');
        shutter.play();
        await takeSnap();
        setTimeout(() => flashEl.classList.remove('flash-active'), 100);
        await new Promise(r => setTimeout(r, 500));
    }
    
    renderStrip();
    canvas.style.display = 'block'; 
    downloadBtn.style.display = 'block';
    qrisPopup.style.display = 'block'; // Munculkan popup donasi
    startBtn.disabled = false;
}

function takeSnap() {
    return new Promise(resolve => {
        const temp = document.createElement('canvas');
        temp.width = 800; temp.height = 800;
        const tCtx = temp.getContext('2d');
        tCtx.filter = "brightness(1.1) contrast(1.1)";
        tCtx.translate(800,0); tCtx.scale(-1,1);
        tCtx.drawImage(video, 0, 0, 800, 800);
        const img = new Image();
        img.onload = () => { capturedImages.push(img); resolve(); };
        img.src = temp.toDataURL('image/png');
    });
}

function renderStrip() {
    canvas.width = 600; canvas.height = 2000;
    ctx.fillStyle = "#ffffff"; ctx.fillRect(0,0,600,2000);
    ctx.fillStyle = "#2d3436"; ctx.textAlign = "center";
    ctx.font = "bold 40px 'Plus Jakarta Sans'";
    ctx.fillText("NARA BOOTH", 300, 80);

    capturedImages.forEach((img, i) => {
        const y = 150 + (i * 450);
        ctx.fillStyle = "#f1f2f6"; ctx.fillRect(45, y-5, 510, 435);
        ctx.drawImage(img, 50, y, 500, 425);
    });
    drawStickersOnly();
}

function addSticker(emoji) {
    stickers.push({ emoji, x: 300, y: 1200 });
    renderStrip();
}

function drawStickersOnly() {
    ctx.font = "80px serif"; ctx.textAlign = "center";
    stickers.forEach(s => ctx.fillText(s.emoji, s.x, s.y));
}

canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    if(stickers.length > 0) {
        const last = stickers[stickers.length-1];
        last.x = (e.touches[0].clientX - rect.left) * (canvas.width / rect.width);
        last.y = (e.touches[0].clientY - rect.top) * (canvas.height / rect.height);
        renderStrip();
    }
}, {passive: false});

function downloadImage() {
    const link = document.createElement('a');
    link.download = `NaraBooth_${Date.now()}.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
}
</script>
</body>
</html>
