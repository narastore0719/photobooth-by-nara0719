<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APONGSKY X STILL ALIVE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --accent: #ff00ff; --bg: #050505; --card: #111; }
        * { box-sizing: border-box; }
        body {
            background: var(--bg); color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; padding: 20px; min-height: 100vh;
        }

        /* Header Sleek */
        header { text-align: center; margin-bottom: 20px; }
        header h1 { letter-spacing: 3px; font-size: 1.5rem; margin: 0; font-weight: 800; }
        header span { color: var(--accent); }
        .sub { font-size: 9px; color: #666; letter-spacing: 2px; text-transform: uppercase; margin-top: 5px; }

        /* Input Area Mahal */
        .input-card {
            background: var(--card); border: 1px solid #222;
            padding: 15px; border-radius: 15px; margin-bottom: 20px;
            width: 100%; max-width: 350px; text-align: center;
        }
        .input-card input {
            width: 100%; background: #000; border: 1px solid #333;
            color: #00ff00; padding: 12px; border-radius: 8px;
            font-size: 11px; margin-bottom: 10px; outline: none;
        }
        .btn-apply {
            background: var(--accent); color: black; border: none;
            padding: 10px 20px; border-radius: 8px; font-weight: bold;
            cursor: pointer; font-size: 11px; width: 100%;
        }

        /* Area Capture (Pusat Masalah Biasanya Di Sini) */
        #capture-area {
            position: relative; width: 320px; height: 850px;
            background: #fff; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }
        .photo-slots {
            display: flex; flex-direction: column; height: 100%;
            padding: 20px; gap: 12px;
        }
        .slot {
            flex: 1; background: #eee; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            border: 1px solid #ddd; position: relative;
        }
        video, .captured-img { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        #main-frame {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none; object-fit: fill;
        }
        .brand-strip {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            font-size: 10px; font-weight: bold; color: rgba(0,0,0,0.2); 
            z-index: 99; letter-spacing: 3px;
        }

        /* Controls */
        .btns { margin-top: 25px; display: flex; gap: 15px; }
        .btn-action {
            background: transparent; border: 2px solid var(--accent);
            color: white; padding: 12px 30px; border-radius: 50px;
            font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .btn-action:hover { background: var(--accent); color: black; }
        .btn-action:disabled { opacity: 0.2; cursor: not-allowed; }

        /* Overlay */
        #countdown {
            display: none; position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-size: 120px;
            font-weight: 900; color: var(--accent); z-index: 1000;
        }
        #loader {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center;
        }
        .saweria { margin-top: 30px; color: #444; font-size: 10px; text-decoration: none; }
    </style>
</head>
<body>

    <header>
        <h1>APONGSKY <span>X</span> STILL ALIVE</h1>
        <div class="sub">VIRTUAL SELF-STUDIO VOL. 01</div>
    </header>

    <div class="input-card">
        <input type="text" id="frame-link" placeholder="PASTE .PNG DIRECT LINK HERE">
        <button class="btn-apply" onclick="updateFrame()">APPLY CUSTOM FRAME</button>
    </div>

    <div id="capture-area">
        <div class="photo-slots">
            <div id="s1" class="slot"><video id="v" autoplay playsinline></video></div>
            <div id="s2" class="slot"></div>
            <div id="s3" class="slot"></div>
            <div id="s4" class="slot"></div>
        </div>
        <img id="main-frame" src="https://i.ibb.co/m0R0m8f/strip-white.png" crossorigin="anonymous">
        <div class="brand-strip">STILL ALIVE</div>
    </div>

    <div id="countdown">3</div>

    <div class="btns">
        <button id="start-btn" class="btn-action" onclick="initSession()">START</button>
        <button id="dl-btn" class="btn-action" style="display:none; border-color:#00ff00;" onclick="saveImg()">SAVE</button>
    </div>

    <div id="loader"><p style="color:var(--accent); letter-spacing:2px;">RENDERING...</p></div>
    <a href="https://saweria.co/youruser" class="saweria" target="_blank">SUPPORT VIA SAWERIA</a>

    <script>
        let step = 0;
        const v = document.getElementById('v');
        const shutter = new Audio('https://www.soundjay.com/mechanical/camera-shutter-click-08.mp3');

        // Kamera Logic (Anti-Lag)
        navigator.mediaDevices.getUserMedia({ video: { width: {ideal: 1280}, height: {ideal: 720} } })
            .then(s => { v.srcObject = s; })
            .catch(e => alert("Camera Error: Izin ditolak atau kamera tidak ditemukan."));

        function updateFrame() {
            const link = document.getElementById('frame-link').value;
            if(link) {
                // Tambahkan crossOrigin biar bisa di-render html2canvas
                const frameImg = document.getElementById('main-frame');
                frameImg.crossOrigin = "anonymous";
                frameImg.src = link;
                alert("Frame Updated!");
            }
        }

        function initSession() {
            step = 0;
            document.getElementById('start-btn').disabled = true;
            document.getElementById('dl-btn').style.display = 'none';
            // Reset slots & kembalikan video ke s1
            for(let i=2; i<=4; i++) document.getElementById('s'+i).innerHTML = '';
            document.getElementById('s1').appendChild(v);
            startCountdown();
        }

        function startCountdown() {
            if(step < 4) {
                let t = 3;
                const c = document.getElementById('countdown');
                c.style.display = 'block'; c.innerText = t;
                const timer = setInterval(() => {
                    t--; c.innerText = t;
                    if(t <= 0) {
                        clearInterval(timer); c.style.display = 'none';
                        takeSnap(step + 1);
                        step++; setTimeout(startCountdown, 1500);
                    }
                }, 1000);
            } else {
                document.getElementById('start-btn').disabled = false;
                document.getElementById('dl-btn').style.display = 'inline-block';
            }
        }

        function takeSnap(id) {
            shutter.play();
            const slot = document.getElementById('s' + id);
            const can = document.createElement('canvas');
            can.width = v.videoWidth; can.height = v.videoHeight;
            const ctx = can.getContext('2d');
            
            // Mirroring Fix
            ctx.translate(can.width, 0); ctx.scale(-1, 1);
            ctx.drawImage(v, 0, 0);
            
            const imgData = can.toDataURL('image/png');
            slot.innerHTML = `<img src="${imgData}" class="captured-img">`;
            
            if(id < 4) document.getElementById('s'+(id+1)).appendChild(v);

            // Flash
            const f = document.createElement('div');
            f.style = "position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:10000;";
            document.body.appendChild(f); setTimeout(() => f.remove(), 100);
        }

        async function saveImg() {
            document.getElementById('loader').style.display = 'flex';
            try {
                const captureArea = document.getElementById('capture-area');
                const finalCan = await html2canvas(captureArea, {
                    useCORS: true,
                    scale: 3, // HD Quality
                    backgroundColor: null
                });
                const a = document.createElement('a');
                a.download = `STILLALIVE_${Date.now()}.png`;
                a.href = finalCan.toDataURL('image/png');
                a.click();
            } catch (e) {
                alert("Render gagal. Pastikan link frame kamu Direct Link (.png)");
            }
            document.getElementById('loader').style.display = 'none';
        }
    </script>
</body>
</html>
