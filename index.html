<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APONGSKY v33.6 | Voice Over & Tags</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Plus+Jakarta+Sans:wght@400;800&family=Special+Elite&family=Syne:wght@800&family=Pacifico&display=swap');
        
        :root { --accent: #facc15; --text-color: #fff; --bg-color: #050505; }
        body { background: var(--bg-color); color: var(--text-color); font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; }
        
        body.mode-tiger { --accent: #facc15; --bg-color: #0a0a0a; --text-color: #fff; }
        body.mode-gemoy { --accent: #f472b6; --bg-color: #fff1f2; --text-color: #be185d; }
        body.mode-cyber { --accent: #8b5cf6; --bg-color: #000; --text-color: #fff; }
        body.mode-press { --accent: #475569; --bg-color: #e2e8f0; --text-color: #0f172a; }

        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 35px; }
        body.mode-gemoy .glass { background: rgba(255, 255, 255, 0.5); border: 1px solid #fbcfe8; }
        body.mode-press .glass { background: rgba(0, 0, 0, 0.05); border: 1px solid #cbd5e1; }
        
        .camera-ring { position: relative; padding: 12px; background: var(--accent); border-radius: 50px; transition: 0.5s; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .camera-view { transform: scaleX(-1); object-fit: cover; border-radius: 38px; }
        
        .btn-main { background: var(--accent); color: #000; font-weight: 900; transition: 0.4s; border-radius: 30px; text-transform: uppercase; font-style: italic; }
        .btn-main:hover { transform: scale(1.02) translateY(-5px); box-shadow: 0 20px 40px -10px var(--accent); }
        
        #flash { position: fixed; inset: 0; background: white; z-index: 9999; opacity: 0; pointer-events: none; }
        .flash-active { animation: flash-anim 0.4s ease-out; }
        @keyframes flash-anim { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 mode-tiger" id="b">

    <div id="flash"></div>

    <div class="max-w-7xl mx-auto no-print">
        <header class="flex flex-col md:flex-row justify-between items-center mb-12">
            <div>
                <h1 class="text-7xl font-800 tracking-tighter italic" style="color: var(--accent)">APONGSKY</h1>
                <p class="text-[10px] tracking-[0.8em] opacity-40 uppercase mt-2 text-center md:text-left">v33.6 Voice Over & Dynamic Tags</p>
            </div>
            <div class="mt-6 md:mt-0 flex flex-col items-center gap-2">
                <a href="https://saweria.co/apongsky73" target="_blank" class="glass px-8 py-3 text-[10px] font-black uppercase tracking-widest border-white/20 hover:bg-white hover:text-black transition">Donate Coffee ‚òï</a>
                <p class="text-[8px] opacity-50 uppercase tracking-widest font-bold">Musik akan menyala saat engine dipilih</p>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <aside class="lg:col-span-3 space-y-6">
                <div class="glass p-8">
                    <p class="text-[11px] font-black uppercase tracking-[0.3em] mb-6 opacity-50">Select Engine</p>
                    <div class="grid grid-cols-1 gap-4">
                        <button onclick="setEngine('tiger')" class="w-full py-4 rounded-2xl bg-yellow-500 text-black font-900 text-[10px] uppercase">üêÖ Tiger Overdrive</button>
                        <button onclick="setEngine('cyber')" class="w-full py-4 rounded-2xl bg-purple-600 text-white font-900 text-[10px] uppercase">ü™ê Cyber Chrome</button>
                        <button onclick="setEngine('gemoy')" class="w-full py-4 rounded-2xl bg-pink-400 text-white font-900 text-[10px] uppercase">üéÄ Ultra Gemoy</button>
                        <button onclick="setEngine('press')" class="w-full py-4 rounded-2xl bg-slate-700 text-white font-900 text-[10px] uppercase">üì∞ Vintage Press</button>
                    </div>
                </div>
                <div class="glass p-6">
                    <input type="text" id="tag" placeholder="ADD CAPTION..." class="w-full bg-white/10 border-none p-3 rounded-xl text-sm outline-none focus:ring-2" style="color: var(--text-color); --tw-ring-color: var(--accent);">
                </div>
            </aside>

            <div class="lg:col-span-6 flex flex-col items-center">
                <div class="camera-ring w-full">
                    <div class="aspect-[3/4] bg-black rounded-[38px] relative overflow-hidden">
                        <video id="v" class="w-full h-full camera-view" autoplay playsinline></video>
                        <div id="count" class="absolute inset-0 flex items-center justify-center text-[200px] font-900 text-white hidden"></div>
                    </div>
                </div>
                <button onclick="startSession()" id="snap-btn" class="btn-main w-full mt-10 py-8 text-3xl tracking-tighter shadow-2xl">
                    SNAP 4 PHOTOS ‚ú®
                </button>
            </div>

            <aside class="lg:col-span-3 glass p-8">
                <p class="text-[11px] font-black opacity-30 uppercase text-center mb-8">Roll Feed</p>
                <div id="gallery" class="space-y-6"></div>
            </aside>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/98 z-[1000] hidden flex items-center justify-center p-6 no-print" style="color: var(--text-color)">
        <div class="max-w-4xl w-full glass p-10 flex flex-col md:flex-row gap-10 items-center">
            <div class="bg-white p-2 rounded shadow-2xl"><canvas id="c" class="w-[280px]"></canvas></div>
            <div class="flex-1 space-y-8">
                <h2 class="text-6xl font-900 italic uppercase" style="color: var(--accent)">Elite!</h2>
                <div class="flex gap-4">
                    <button onclick="location.reload()" class="flex-1 py-4 glass font-black text-xs uppercase">Discard</button>
                    <button onclick="window.print()" class="flex-1 py-4 btn-main text-black font-black text-xs uppercase">Print Strip</button>
                </div>
                <a href="https://saweria.co/apongsky73" target="_blank" class="block text-center text-[10px] opacity-50 underline">Support Admin via Saweria ‚òï</a>
            </div>
        </div>
    </div>

    <div class="hidden print:block"><img id="print-img" class="w-full"></div>

    <script>
        const v = document.getElementById('v');
        const c = document.getElementById('c');
        const countEl = document.getElementById('count');
        const gallery = document.getElementById('gallery');
        const flash = document.getElementById('flash');
        const b = document.getElementById('b');
        const tagInput = document.getElementById('tag');
        
        let poses = [];
        let curMode = 'tiger';
        const sfxShutter = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-camera-shutter-click-1133.mp3');
        const synth = window.speechSynthesis;

        const music = new Audio();
        music.loop = true;
        const tracks = {
            tiger: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3', 
            cyber: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3', 
            gemoy: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3', 
            press: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3'  
        };

        const voices = {
            tiger: "ROAR! Bersiap untuk foto terbaikmu!",
            cyber: "Sistem aktif. Siapkan pose futuristik Anda!",
            gemoy: "Hai manis! Yuk berpose yang paling gemoy!",
            press: "Perhatian! Senyum terbaik untuk berita utama hari ini!"
        };

        const defaultTags = {
            tiger: "Ëôé TIGER ROAR Ëôé",
            cyber: "FUTURE_CORE 2026",
            gemoy: "Sweet Memories ‚ú®",
            press: "THE DAILY PRESS"
        };

        navigator.mediaDevices.getUserMedia({ video: { width: 1080, height: 1440 } }).then(s => v.srcObject = s);

        function setEngine(m) {
            curMode = m;
            b.className = 'min-h-screen p-4 md:p-8 mode-' + m;
            
            // Update tag input placeholder and value
            tagInput.placeholder = defaultTags[m];
            tagInput.value = ''; // Clear previous tag for new theme

            music.src = tracks[m];
            music.play().catch(() => console.log("User must interact first"));

            if(m === 'press') v.style.filter = "grayscale(1) contrast(1.3)";
            else if(m === 'tiger') v.style.filter = "contrast(1.2) brightness(1.1)";
            else if(m === 'gemoy') v.style.filter = "brightness(1.1) saturate(1.2)";
            else v.style.filter = "contrast(1.1) saturate(1.4)";
        }

        async function startSession() {
            poses = []; gallery.innerHTML = '';
            document.getElementById('snap-btn').disabled = true;

            music.pause(); // Pause background music during countdown

            const utter = new SpeechSynthesisUtterance(voices[curMode]);
            utter.lang = 'id-ID'; 
            synth.speak(utter);
            await new Promise(r => setTimeout(r, 2000)); // Delay after voice over

            for(let i=1; i<=4; i++) {
                let t = 3; countEl.classList.remove('hidden');
                while(t > 0) { countEl.innerText = t; await new Promise(r => setTimeout(r, 1000)); t--; }
                countEl.classList.add('hidden'); snap();
                if(i < 4) await new Promise(r => setTimeout(r, 1500));
            }
            renderFinal();
        }

        function snap() {
            sfxShutter.play(); flash.classList.add('flash-active');
            setTimeout(() => flash.classList.remove('flash-active'), 400);
            const temp = document.createElement('canvas'); temp.width = 1080; temp.height = 800;
            const ctx = temp.getContext('2d');
            ctx.filter = v.style.filter;
            ctx.translate(1080, 0); ctx.scale(-1, 1);
            ctx.drawImage(v, 0, 0, 1080, 800);
            poses.push(temp.toDataURL('image/jpeg', 0.9));
            const img = document.createElement('img'); img.src = poses[poses.length-1]; 
            img.className = "rounded-2xl border border-white/20";
            gallery.prepend(img);
        }

        async function renderFinal() {
            music.pause(); // Ensure music is off
            const ctx = c.getContext('2d');
            c.width = 1000; c.height = 1600;

            if(curMode === 'tiger') ctx.fillStyle = '#000';
            else if(curMode === 'gemoy') ctx.fillStyle = '#fbcfe8';
            else if(curMode === 'press') ctx.fillStyle = '#f1f5f9';
            else ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, c.width, c.height);

            const drawBox = async (x) => {
                for(let i=0; i<4; i++) {
                    const img = new Image(); img.src = poses[i];
                    await new Promise(r => img.onload = r);
                    ctx.fillStyle = "#fff";
                    if(curMode === 'gemoy') {
                        ctx.save(); ctx.beginPath(); ctx.roundRect(x+40, 40 + (i*360), 420, 320, 50); ctx.fill(); ctx.clip();
                        ctx.drawImage(img, x+40, 40 + (i*360), 420, 320); ctx.restore();
                    } else {
                        ctx.fillRect(x+35, 35 + (i*360), 430, 330);
                        ctx.drawImage(img, x+40, 40 + (i*360), 420, 320);
                    }
                }
                
                ctx.textAlign = 'center';
                const currentTag = tagInput.value || tagInput.placeholder; // Use user input or default
                
                if(curMode === 'tiger') {
                    ctx.fillStyle = '#facc15'; ctx.font = '800 60px UnifrakturMaguntia';
                    ctx.fillText(currentTag, x + 250, 1515);
                } else if(curMode === 'cyber') {
                    ctx.fillStyle = '#fff'; ctx.font = '900 45px Syne';
                    ctx.fillText(currentTag, x + 250, 1515);
                } else if(curMode === 'gemoy') {
                    ctx.fillStyle = '#be185d'; ctx.font = '35px Pacifico';
                    ctx.fillText(currentTag, x + 250, 1530);
                } else {
                    ctx.fillStyle = '#0f172a'; ctx.font = '800 40px Special Elite';
                    ctx.fillText(currentTag, x + 250, 1510);
                }
            }

            await drawBox(0); await drawBox(500);
            document.getElementById('print-img').src = c.toDataURL('image/png');
            document.getElementById('modal').classList.remove('hidden');
        }

        // Initialize with default tiger mode on load
        setEngine('tiger'); 
    </script>
</body>
</html>
