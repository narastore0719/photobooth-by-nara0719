<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NaraBooth Ultra HD V17</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #ff7675; --bg: #0f1115; --glass: rgba(255, 255, 255, 0.08); }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; display: flex; justify-content: center; min-height: 100vh; overflow-x: hidden; }
        
        .container { width: 100%; max-width: 500px; background: #1a1c23; padding: 25px; border-radius: 40px; box-shadow: 0 40px 100px rgba(0,0,0,0.8); border: 2px solid #333; }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { margin: 0; font-size: 28px; font-weight: 800; background: linear-gradient(45deg, #ff7675, #fab1a0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -1px; }

        /* Kamera Ukuran Besar & HD */
        .screen-container { position: relative; background: #000; border-radius: 30px; overflow: hidden; aspect-ratio: 1/1; border: 4px solid #2d3436; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .timer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 100px; font-weight: 800; z-index: 100; color: white; text-shadow: 0 5px 30px rgba(0,0,0,0.8); }
        
        /* Efek Flash Cuma di Preview Kamera */
        .flash-effect { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; z-index: 99; }
        .flash-active { opacity: 1; transition: 0.1s; }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .control-item { background: var(--glass); border: 1px solid #444; color: white; padding: 15px; border-radius: 18px; font-weight: 700; outline: none; }

        .sticker-box { display: flex; gap: 15px; overflow-x: auto; padding: 15px; background: #111; border-radius: 20px; margin-bottom: 20px; border: 1px solid #333; }
        .sticker-item { font-size: 35px; cursor: pointer; transition: 0.2s; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3)); }

        #startBtn { width: 100%; background: linear-gradient(135deg, #ff7675 0%, #d63031 100%); color: white; border: none; padding: 22px; border-radius: 25px; font-size: 18px; font-weight: 800; cursor: pointer; box-shadow: 0 10px 30px rgba(214, 48, 49, 0.4); margin-bottom: 10px; }
        #startBtn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        canvas { max-width: 100%; border-radius: 20px; margin-top: 25px; display: none; touch-action: none; box-shadow: 0 30px 60px rgba(0,0,0,0.6); }
        .btn-save { background: #00b894; color: white; border: none; padding: 20px; border-radius: 20px; width: 100%; margin-top: 15px; display: none; font-weight: 800; cursor: pointer; }
        
        .saweria-btn { background: #feca57; color: #2d3436; text-decoration: none; font-weight: 800; padding: 15px 30px; border-radius: 20px; display: inline-block; box-shadow: 0 8px 25px rgba(254, 202, 87, 0.4); animation: pulse 2s infinite; font-size: 15px; margin-top: 20px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>NARA BOOTH</h1>
        <p style="font-size: 10px; opacity: 0.5; letter-spacing: 2px;">ULTRA HD ‚Ä¢ CLEAN EDITION</p>
    </div>

    <div class="screen-container">
        <div id="flash" class="flash-effect"></div>
        <div id="timer" class="timer"></div>
        <video id="webcam" autoplay playsinline></video>
    </div>

    <div class="controls">
        <select id="filterSelect" class="control-item">
            <option value="none">4K Natural</option>
            <option value="brightness(1.1) contrast(1.1)">Studio Glow</option>
            <option value="grayscale(100%) contrast(1.2)">Noir Edition</option>
            <option value="saturate(1.4)">Ultra Vivid</option>
        </select>
        <input type="color" id="frameColor" class="control-item" value="#ffffff" style="padding: 5px;">
    </div>

    <div class="sticker-box">
        <span class="sticker-item" onclick="addSticker('üê±')">üê±</span>
        <span class="sticker-item" onclick="addSticker('üéÄ')">üéÄ</span>
        <span class="sticker-item" onclick="addSticker('‚ú®')">‚ú®</span>
        <span class="sticker-item" onclick="addSticker('‚ù§Ô∏è')">‚ù§Ô∏è</span>
        <span class="sticker-item" onclick="addSticker('üêª')">üêª</span>
        <span class="sticker-item" onclick="addSticker('üëë')">üëë</span>
        <span class="sticker-item" onclick="addSticker('üç≠')">üç≠</span>
    </div>

    <button id="startBtn" onclick="startSession()">üì∏ START SESSION</button>

    <canvas id="finalCanvas"></canvas>
    <button id="downloadBtn" class="btn-save" onclick="downloadImage()">üíæ SIMPAN FOTO HD</button>

    <div style="text-align: center;">
        <a href="https://saweria.co/narastore0719" target="_blank" class="saweria-btn">‚òï SUPPORT VIA SAWERIA</a>
    </div>
</div>

<audio id="beep" src="https://www.soundjay.com/button/beep-07.mp3"></audio>
<audio id="shutter" src="https://www.soundjay.com/free-music/shutter-click-01.mp3"></audio>
<audio id="cheer" src="https://www.soundjay.com/human/applause-01.mp3"></audio>

<script>
const video = document.getElementById('webcam');
const timerEl = document.getElementById('timer');
const flashEl = document.getElementById('flash');
const canvas = document.getElementById('finalCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const downloadBtn = document.getElementById('downloadBtn');

const beep = document.getElementById('beep');
const shutter = document.getElementById('shutter');
const cheer = document.getElementById('cheer');

let capturedImages = [], stickers = [];

// Request Kamera Kualitas Tertinggi
navigator.mediaDevices.getUserMedia({ 
    video: { facingMode: "user", width: { ideal: 1920 }, height: { ideal: 1920 } } 
}).then(s => video.srcObject = s);

async function startSession() {
    capturedImages = []; stickers = [];
    canvas.style.display = 'none'; downloadBtn.style.display = 'none';
    startBtn.disabled = true;

    for(let i=0; i<4; i++) {
        for(let c=3; c>=0; c--) {
            timerEl.innerText = c > 0 ? c : "";
            if(c > 0) beep.play();
            await new Promise(r => setTimeout(r, 1000));
        }
        
        // Flash cuma di preview kamera
        flashEl.classList.add('flash-active');
        shutter.play();
        takeSnap();
        setTimeout(() => flashEl.classList.remove('flash-active'), 100);
        await new Promise(r => setTimeout(r, 500));
    }
    
    // Langsung munculin frame dengan mulus
    renderStrip();
    canvas.style.display = 'block'; 
    downloadBtn.style.display = 'block';
    startBtn.disabled = false;
    cheer.play();
}

function takeSnap() {
    const temp = document.createElement('canvas');
    temp.width = 1200; temp.height = 1200;
    const tCtx = temp.getContext('2d');
    tCtx.filter = document.getElementById('filterSelect').value;
    tCtx.translate(1200,0); tCtx.scale(-1,1);
    tCtx.drawImage(video, 0, 0, 1200, 1200);
    capturedImages.push(temp.toDataURL('image/png'));
}

function renderStrip() {
    canvas.width = 800; canvas.height = 2600;
    const bg = document.getElementById('frameColor').value;
    ctx.fillStyle = bg; ctx.fillRect(0,0,800,2600);
    
    ctx.fillStyle = isDark(bg) ? "#fff" : "#2d3436";
    ctx.textAlign = "center";
    ctx.font = "bold 50px 'Plus Jakarta Sans'"; ctx.fillText("NARA BOOTH", 400, 110);

    capturedImages.forEach((src, i) => {
        const img = new Image();
        img.src = src;
        img.onload = () => {
            const y = 200 + (i * 580);
            ctx.fillStyle = "white"; 
            ctx.fillRect(95, y-5, 610, 560);
            ctx.drawImage(img, 100, y, 600, 550);
            if(i === 3) drawStickers();
        };
    });
}

function addSticker(emoji) {
    stickers.push({ emoji, x: 400, y: 1500 });
    drawStickers();
}

function drawStickers() {
    renderStrip();
    ctx.font = "100px serif";
    stickers.forEach(s => ctx.fillText(s.emoji, s.x, s.y));
}

canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    if(stickers.length > 0) {
        stickers[stickers.length-1].x = (e.touches[0].clientX - rect.left) * (canvas.width / rect.width);
        stickers[stickers.length-1].y = (e.touches[0].clientY - rect.top) * (canvas.height / rect.height);
        drawStickers();
    }
}, {passive: false});

function downloadImage() {
    const link = document.createElement('a');
    link.download = `NaraBooth_HD_${Date.now()}.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
}

function isDark(color) {
    const r = parseInt(color.substr(1,2),16);
    const g = parseInt(color.substr(3,2),16);
    const b = parseInt(color.substr(5,2),16);
    return (r*0.299 + g*0.587 + b*0.114) < 128;
}
</script>
</body>
</html>
